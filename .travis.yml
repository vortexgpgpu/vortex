language: cpp
dist: bionic
os: linux
compiler: gcc
addons:
    apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - build-essential
        - valgrind
        - verilator
        - yosys

install:
  # TOOLCHAIN
  - ci/toolchain_install.sh -all
  - export RISCV_TOOLCHAIN_PATH=/opt/riscv-gnu-toolchain
  - export VERILATOR_ROOT=/opt/verilator
  - export PATH=$VERILATOR_ROOT/bin:$PATH 

script:   
  - travis_wait 45 make
  - travis_wait 45 ci/test_runtime.sh
  - travis_wait 45 ci/test_driver.sh
  - travis_wait 45 ci/test_riscv_isa.sh
  - travis_wait 45 ci/test_opencl.sh
  - travis_wait 45 ci/blackbox.sh --driver=rtlsim
  - travis_wait 45 ci/blackbox.sh --driver=vlsim
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --scope
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --debug
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --cores=1 
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --cores=2
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --cores=4
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --cores=2 --l2cache
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --cores=4 --l2cache
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --cores=2 --l2cache --clusters=2
  - travis_wait 45 ci/blackbox.sh --driver=vlsim --cores=2 --l2cache --clusters=4
  
after_success:
  # Gather code coverage
  - lcov --directory . --capture --output-file coverage.info # capture trace  
  - lcov --list coverage.info # trace report
  # Upload coverage report
  - bash <(curl -s https://codecov.io/bash)
